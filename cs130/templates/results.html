{% extends "application.html" %}

{% load static %}

{% block title %}Search results for {{search_query}} {% endblock %}

{% block javascript %}
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.1.min.js" type="text/javascript"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.13/jquery-ui.min.js" type="text/javascript"></script>
<script type="text/javascript">
	$(function() {
		$( "#tabs" ).tabs();
	});
</script>
{% endblock %}

{% block header %}
  <div class="main-search-box">
    <img src="{% get_static_prefix %}logo_large.png" class="logo-large" />
    <div class="search-box">
      <form action="/search" method="get" class="search-form">
        {{ search_form }}
        <input type="submit" value="Search" class="search-button">
      </form>
    </div>
  </div>
{% endblock %}

{% block content %}

  <div id="results-wrapper" class="box-shadow">
  
    <div id="tabs">
      <ul>
        <li><a href="#list-tab">List View</a></li>
        <li><a href="#map-tab", id="load-map">Map View</a></li>
      </ul>
      <div id="list-tab">
        <!-- Ebay Results -->
        <h1>Search results for "{{search_query}}"</h1>
        <div class="results">
        {% for item in item_list %}
          <div class="item">
            <div class="item-score">
              <div class="square {{item.score_color}}"><span class="score">{{item.score}}</span></div>
            </div>  
            <div class="item-image">
              <img src="{{item.galleryURL}}" />
            </div>

            <div class="item-info">
              <h2><a href="{{item.viewItemURL}}">{{item.title}}</a><br/></h2>
              Location: {{item.location}} <br/><br/>
              <b>
              Current Price: {{item.sellingStatus.currentPrice.value}} {{item.sellingStatus.currentPrice.currencyId}} <br/>
              Time Left: {{item.sellingStatus.timeLeft}} <br/>
              Product ID: {{item.productId}} <br/>
              Score: {{item.score}} <br/>
              Individual Scores: {{item.individual_scores}}
              </b>
            </div>
          </div>

        {% endfor %}
        </div>
      </div>
      <div id="map-tab">
        <!-- Google Maps -->
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript">
        //<![CDATA[
        $(document).ready(function() {
          var user_longitude = "{{location_info.longitude}}";
          var user_latitude = "{{location_info.latitude}}";
          function initialize(latitude, longitude) {
            var latlng = new google.maps.LatLng(latitude, longitude);
            var myOptions = {
              zoom: 10,
              center: latlng,
              mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
          }
          $('#load-map').click(function() {
              $('#map-tab').css({'display':'block'});
              initialize(user_latitude, user_longitude);
          
          });
        });
        //]]>
        </script>
        <div id="map-canvas"></div>
      </div>
    </div>
  </div>
  
{% endblock %}